# TAREAS PENDIENTES

- Completar estructura EnergyIndicators.elements (ElementProps)?
  - Spaces: {A, V, p_ext (perimetro expuesto), inside_et}
  - Walls: {A_gross, A_net, U, inside_et, space_id}
  - Windows: {A, U, g_glwi, g_glshwi, f_shobst, inside_et, wall?, space_id}
  - WallCons: { R_intrinsic }
  - WinCons: { U-value }
  - indicando elementos que pertenecen a la envolvente
    - los elementos interiores de la ET son aquellos que no comunican con otros espacios interiores a la envolvente
    - ¿ agrupados por tipo y con datos de condición de contorno EXTERIOR, GROUND, ADIABATIC, INTERIOR ?
  - Podríamos usar esa estructura como caché?
    - Si los recorremos en el orden adecuado (ADIABATIC -> EXTERIOR, GROUND, INTERIOR) deberíamos minimizar recálculos
    - Si no, con una caché en u_for_wall() debería dar casi igual
- Mover grupos a `model.library.{materials, glass, frame, wallcons, windowcons}=Map<groupname, uuid>` y eliminar grupos en esos objetos
- Cachear A de huecos y de muros en bemodel::energy::indicators(), usándolo para luego calcular U
- Convertir UValues a AUValues en IndicatorsReport
- Separar check de cálculo energético
- Convertir name a ArrayString
  - <https://docs.rs/arrayvec/0.7.1/arrayvec/struct.ArrayString.html>
  - Ver tamaño máximo de name, id son 36 caracteres en representación de texto
- Trasladar avisos en la conversión de modelos BDL
- En bemodel hacer las comprobaciones de los modelos en lugar de en hulc2model, que simplemente debería convertir los casos.
- Validación JSON? <https://www.npmjs.com/package/is-my-json-valid>

Ver qué ocurre con elementos especiales de la ET, y cómo se habilita la posibilidad de ignorar esos elementos para el cálculo de la K. - añadiendo un identificador en el nombre (p.e. EXCLUYE_HE1_K) - pasando una lista de elementos excluidos

## Comprobaciones

- Ver si se puede calcular bien la altura de espacios / plantas usando altura de espacio y no de planta
- Ver si se calcula bien la altura neta / volumen interior de espacios con cerramientos superior e inferior adiabático
- Ver si se calcula bien el volumen de espacios con cerramientos inclinados

## Modelo

### Datos del modelo

- Superficies de muros y opacos siempre calculadas desde definición geométrica:
  - Polígono de muros por defecto con:
    - ancho = superficie / altura de planta
    - ancho = superficie / 3.0
  - huecos:
    - alto = 1m
    - ancho = superficie / alto
- El perímetro expuesto se podría eliminar de bemodel/space, calculándolo como en bdl/space l.110 a partir de los muros y suelos
  - parte del perímetro que tiene muros con el exterior
- Ushwi: transmitancia de huecos con contraventanas activadas (en construcción de hueco)
- Crear biblioteca base de materiales en Rust para interpretar construcciones:
  - BDCatalogo.bdc.utf8 -> Convertir a datos Rust

### Chequeos de modelo

- Perímetro expuesto < perímetro de suelos del espacio
- Superficie de espacio < % de suma de superficie de opacos suelo
- Superficies de hueco < superficie de opaco en el que se inserta

### bemodel

- Ver funciones que se podrían hacer infalibles sabiendo que hay definición geométrica (punto + poly)
  - implementar is_full_geometry (e.geometry.position.is_some()) y filtrar

### Lamas en huecos

- Dar soporte a lamas horizontales y verticales

### Estimar longitudes de PTs (ver heurísticas de CERMA, etc)

### Sombras

- Método del daylight coefficients para reducir cálculos y mejorar precisión
- <http://performativedesign.com/articles/2007/shadingcalculations/>
- <http://performativedesign.com/articles/2008/averagehourly/>
- <https://riunet.upv.es/bitstream/handle/10251/7482/tesisUPV3258.pdf>
- <https://idus.us.es/handle/11441/15301> p. 124
- Reducir diferencia con HULC en qsoljul
  - Ver qué día del año usar...
- Caso de las lamas (blinds)
  - Vamos a tantear primero qué valores salen bloqueando solo la radiación directa, comparando con tablas DA DB-HE.
  - Se puede usar la referencia de EnergyPlus (más sencilla), la ISO 15099 (más precisa) o, mejor, la UNE-EN ISO 52022-3,
    aunque esta última considera que no hay transmisión directa (que es fácil de añadir, incorporando la transmissión directa como se indica en E+ y cambiando los factores de visibilidad, que también se pueden calcular con el Hottel's crossed strings method).
  - <http://www.ibpsa.org/proceedings/BS2001/BS01_0457_464.pdf>
  - <https://bigladdersoftware.com/epx/docs/9-5/engineering-reference/window-calculation-module.html#blinds>
    - Se calcula la radiación directa (directa-directa) <https://bigladdersoftware.com/epx/docs/9-5/engineering-reference/window-calculation-module.html#direct-to-direct-blind-transmittance>
      - tau_dir,dir = 1 - |s. cos(elev_b - elev_s) / cos elev_s) / h, con |w| <= h
      - A ver qué sale para el 21 de junio con esto y si se corresponde con lo que tenemos en el DA.
    - Se calcula la radiación directa a difusa (directa-difusa) <https://bigladdersoftware.com/epx/docs/9-5/engineering-reference/window-calculation-module.html#direct-to-diffuse-blind-transmittance-reflectance-and-absorptance>
    - Se calcula la radiación difusa a difusa (difusa-difusa) <https://bigladdersoftware.com/epx/docs/9-5/engineering-reference/window-calculation-module.html#diffuse-to-diffuse-transmittance-and-reflectance-of-blind>

### Importación / Exportación

- importación de OpenStudio
  - Usa EpJSON, ver OpenStudio/src/epjson/epJSONTranslator.{hpp, cpp}
  - <https://github.com/NREL/OpenStudio/blob/develop/src/epjson/epJSONTranslator.hpp>
  - <https://raw.githubusercontent.com/NREL/OpenStudio/develop/resources/model/OpenStudio.idd>
  - <https://openstudio-sdk-documentation.s3.amazonaws.com/cpp/OpenStudio-3.1.0-doc/model/html/index.html#object_implementation>
- importación de epJSON: <https://bigladdersoftware.com/epx/docs/9-1/essentials/title.html#epjson>
  - <https://energyplus.readthedocs.io/en/latest/schema.html>
  - <https://energyplus.net/documentation>
  - GlobalGeometryRules
  - Zone
  - Material, Material:NoMass, Material:AirGap, WindowMaterial:Glazing, WindowMaterial:Gas
  - WindowMaterial:SimpleGlazingSystem (WindowMaterial:Glazing + WindowMaterial:Gas, con U + SHGC)
  - WindowProperty:FrameAndDivider - Puentes térmicos de ventanas
  - Construction (list of materials)
  - **BuildingSurface:Detailed, FenestrationSurface:Detailed, and Shading:Zone:Detailed**
    - Wall:Detailed, Wall:Exterior, Wall:Adiabatic, Wall:Underground, Wall:Interzone
    - RoofCeiling:Detailed, Roof
    - Floor:Detailed, Floor:GroundContact, Floor:Adiabatic, Floor:Interzone
    - Ceiling:Adiabatic, Ceiling:Interzone
    - Window, Window:Interzone
    - Door, GlazedDoor, Door:Interzone, GlazedDoor:Interzone
    - Shading:Site, Shading:Building, Shading:Overhang, Shading:Overhang:Projection, Shading:Fin, Shading:Fin:Projection
  - SurfaceProperty:ExposedFoundationPerimeter
- importación de IFC:
  - <https://github.com/tomvandig/web-ifc>
  - <https://github.com/opensourceBIM/IfcValidator>

### Esquema de datos

- Esquema JSON - <https://www.npmjs.com/package/is-my-json-valid>
  - <http://json-schema.org/>

### Cálculos adicionales

- Calcular más cosas:

- Módulo para calcular propiedades de elementos
  - Calculador de elementos para obtener % de afección de U según intercalarios
    y cajón de persiana a partir de expresiones en DA DB-HE1 (p.13)
  - propiedades de vidrios con protecciones móviles, etc
  - Fshobst de huecos según retranqueos, voladizos, aletas, etc s/ 52016-1
  - Generador de construcciones a partir de definición por capas

## BDL

- Quitar de los elementos aquellas cosas que necesitan consultas globales (con acceso a bdldata)
- Comprobar qué se cambia en las plantas o en el edificio cuando se indica una cota base distinta a la 0.0 (ver si se pone la Z de la planta P01 distinta a "")
- Seguir eliminando bloques genéricos convirtiendo a estructuras los elementos BDL:
  - metadatos
  - horarios
  - condiciones operacionales
  - consignas
- Trasladar cálculo de Fshobst de 52016-1 en lugar de DA DB-HE/1 y reutilizar módulo nuevo

## docs

Documentar hipótesis:

- El volumen de los espacios se calcula a partir de su superficie y altura, no se hace cálculo geométrico
- Suponemos que la cota z de los elementos enterrados es igual a la z del suelo del espacio en el que se encuentran
- Ignoramos el dato de Z-GROUND de elementos enterrados. Avisar
- Suponemos que la altura de los espacios es igual a la altura suelo-suelo de las plantas y descontamos el grosor de forjado superior.
- Avisar de incoherencias entre altura de espacios y plantas (pensar cómo, p.e. altura de planta < altura de espacio?)
- Solamente se contempla la obstrucción de la radiación solar directa. Para la radiación difusa se toman valores fijos de los factores de visibilidad del cielo y del suelo (0.5) sin contemplar obstrucciones remotas. Esto tiende a sobreestimar el valor de Fshobst.
